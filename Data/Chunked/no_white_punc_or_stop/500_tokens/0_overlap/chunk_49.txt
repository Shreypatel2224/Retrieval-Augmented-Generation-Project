Attempt debit money account 1 UPDATE accounts SET balance balance amount accountid senderid Attempt credit money account 2 UPDATE accounts SET balance balance amount accountid receiverid Check sufficient funds account 1 SELECT balance accounts accountid senderid 0 Roll back transaction insufficient funds ROLLBACK SIGNAL SQLSTATE 45000 SET MESSAGETEXT rollbackmessage ELSE Log transactions sufficient funds INSERT transactions accountid amount transactiontype VALUES senderid amount WITHDRAWAL